/*! fread - v0.1.1 - 2014-03-23
* http://github.com/rmcvey
* Copyright (c) 2014 Rob McVey; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):a.fread=b()}(this,function(){"use strict";function a(a){if("undefined"==typeof document)return!1;var b={"in":'input[type="file"]',out:"table",before:function(){},after:function(){}};if(this.image_pattern="image.*",this.csv_pattern="text.*",this.params=c.merge(b,a),this.in_target=this.params.in&&document.querySelector(this.params.in)||document.querySelector(b.in),this.out_target=this.params.out&&document.querySelector(this.params.out)||b.out,!1 in this.in_target||!1 in this.out_target)return!1;var d=this;this.in_target.addEventListener("change",function(a){d.params.before.call(a),d.handler.call(d,a,d.params.after)},!1)}var b={create:function(a,b){b=b||{};var c,d,e=document.createElement(a),f="style"in b&&b.style||[],g="";delete b.style;for(c in b)e.setAttribute(c,b[c]);for(d in f)g+=d+":"+f[d]+";";return e.setAttribute("style",g),e}},c={merge:function(a,b){if("undefined"==typeof b||!b)return a;for(var c in a)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}};return a.prototype={in_target:null,out_target:null,data:[],handler:function(a,b){for(var c,d,e=a.target.files,f=this,g=!1,h=[],i=0;d=e[i];i++){if(d.type.match(f.csv_pattern))g="csv";else{if(!d.type.match(f.image_pattern))continue;g="image"}c="writer"in f.params?f.params.writer:f.writers[g],h=f.readers[g].call(f,d,a,c,b)}},writers:{csv:function(a){var b=this,c=!1,d=0,e=b.out_target.querySelector("tbody");a.forEach(function(a,f){var g="<td>",h="</td>",i=document.createElement("tr"),j=e,k="",l=0;for(0!=f||c?j=e:(j=b.out_target.querySelector("thead"),d=a.length,c=!0,g="<th>",h="</th>");d>l;l++)k+=[g,a[l],h].join("");i.innerHTML=k,j.appendChild(i)})},image:function(a,c){var d=this,e=b.create("div",{"class":"thumb-container"}),f=b.create("img",{src:a.target.result,title:escape(c.name),"class":"thumb"});e.appendChild(f),d.out_target.appendChild(e,null)}},readers:{csv:function(a,b,c,d){var e=new FileReader,f=this;e.onload=function(a,b){return function(a){var c=(document.createElement("span"),a.target.result.split("\n"));c.forEach(function(a){var b=a.split(",");f.data.push(b)}),b.call(f,f.data),d.call(f,f.data)}}(a,c),e.readAsText(a)},image:function(a,b,c,d){var e=this,f=new FileReader;f.onload=function(a){return function(b){e.data.push(a),c.call(e,b,a),d.call(e,a)}}(a),f.readAsDataURL(a)}}},a});