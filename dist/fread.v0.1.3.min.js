/*! fread - v0.1.3 - 2014-03-25
* http://github.com/rmcvey
* Copyright (c) 2014 Rob McVey; Licensed  */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define([],b):a.fread=b()}(this,function(){"use strict";function a(a){if("undefined"==typeof document)return!1;var b={"in":'input[type="file"]',out:"table",before:function(){},after:function(){},writer:null};if(this.image_pattern="image.*",this.csv_pattern="text.*",this.params=c.merge(b,a),this.in_target=this.params.in&&document.querySelector(this.params.in)||document.querySelector(b.in),this.out_target=this.params.out&&document.querySelector(this.params.out)||b.out,!c.is_queryable(this.in_target)||!c.is_queryable(this.out_target))return!1;var d=this;this.in_target.addEventListener("change",function(a){d.params.before.call(a),d.handler.call(d,a,d.params.after)},!1)}var b={create:function(a,b){b=b||{};var c,d,e=document.createElement(a),f="style"in b&&b.style||[],g="";delete b.style;for(c in b)e.setAttribute(c,b[c]);for(d in f)g+=d+":"+f[d]+";";return e.setAttribute("style",g),e}},c={merge:function(a,b){if("undefined"==typeof b||!b)return a;for(var c in a)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},is_queryable:function(a){return"querySelector"in a}};return a.prototype={in_target:null,out_target:null,data:[],handler:function(a,b){for(var c,d,e=a.target.files,f=this,g=!1,h=[],i=0;d=e[i];i++){if(d.type.match(f.csv_pattern))g="csv";else{if(!d.type.match(f.image_pattern))continue;g="image"}c="writer"in f.params&&null!==f.params.writer?f.params.writer:f.writers[g],h=f.readers[g].call(f,d,a,c,b)}},writers:{csv:function(a,c){for(var d=this,e=a.length,f=d.out_target.querySelector("tbody"),g=b.create("tr"),h="",i=0;i<a.length;i++)h+=["<th>",a[i],"</th>"].join("");g.innerHTML=h,d.out_target.querySelector("thead").appendChild(g),c.forEach(function(a){for(var b=document.createElement("tr"),c=0,d="";e>c;c++)d+=["<td>",a[c],"</td>"].join("");b.innerHTML=d,f.appendChild(b)})},image:function(a){var c=this,d=b.create("div",{"class":"thumb-container"}),e=b.create("img",{src:a.src,title:escape(a.name),"class":"thumb"});d.appendChild(e),c.out_target.appendChild(d,null)}},readers:{csv:function(a,b,c,d){var e=new FileReader,f=this;e.onload=function(a,b){return function(a){var c=(document.createElement("span"),a.target.result.split("\n"));c.forEach(function(a){var b=a.split(",");f.data.push(b)});var e=[f.data[0],f.data.slice(1)];b.apply(f,e),d.apply(f,e)}}(a,c),e.readAsText(a)},image:function(a,b,c,d){var e=this,f=new FileReader;f.onload=function(a){return function(b){a.src=b.target.result,e.data.push(a),c.call(e,a),d.call(e,e.data)}}(a),f.readAsDataURL(a)}}},a});